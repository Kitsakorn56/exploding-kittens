<!DOCTYPE html>
<html lang="th" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1F6C36">
    <title>‡πÄ‡πÄ‡∏°‡∏ß‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î √ó Multiplayer</title>
    <link rel="icon" type="image/png" href="/logo-title.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="/style.css">
    <style>
      /* ‚îÄ‚îÄ Logo sizing overrides ‚îÄ‚îÄ */
      .logo-hero {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0;
      }
      .logo-hero img {
        /* ‚òÖ ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô ‚Äî mobile: 220px, desktop: 320px */
        width: clamp(200px, 60vw, 320px);
        height: auto;
        object-fit: contain;
        filter: drop-shadow(0 6px 24px rgba(201,151,58,0.35));
        animation: logo-float 4s ease-in-out infinite;
      }
      @keyframes logo-float {
        0%,100% { transform: translateY(0px); }
        50%      { transform: translateY(-6px); }
      }
      .logo-subtitle {
        text-align: center;
        color: var(--text-3);
        font-size: 0.82rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        margin-top: 10px;
        margin-bottom: 0;
      }
      /* Lobby logo ‚Äî ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ lobby */
      .logo-lobby img {
        width: clamp(140px, 40vw, 220px);
      }
    </style>
</head>
<body class="bg-dark text-light">

<!-- Loading Overlay -->
<div id="loadingOverlay">
    <div id="loadingFallback">
        <div class="loading-spinner"></div>
        <div style="color:var(--text-2);font-size:0.95rem;letter-spacing:0.05em;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="toast-custom" style="display:none;"></div>

<!-- Win Screen Overlay -->
<div id="winScreen" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.88); z-index:9998; align-items:center; justify-content:center; flex-direction:column;">
    <div class="win-card">
        <div class="win-emoji">üèÜ</div>
        <h2 id="winnerName" class="win-title"></h2>
        <p id="winMessage" class="win-msg"></p>
        <div class="d-flex gap-3 flex-wrap justify-content-center mt-4">
            <button id="hostNextGameBtn" class="btn btn-success fw-bold" onclick="playAgain()" style="display:none;">
                <i class="fas fa-redo me-2"></i>‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
            </button>
            <button class="btn btn-ghost" onclick="backToLobbyFromWin()">
                <i class="fas fa-door-open me-2"></i>‡∏Å‡∏•‡∏±‡∏ö Lobby
            </button>
        </div>
    </div>
</div>

<!-- Top Controls -->
<div class="position-fixed top-3 end-3 d-flex align-items-center gap-2" style="z-index:50; top:16px; right:16px;">
    <button class="btn btn-ghost btn-sm px-2 py-2" onclick="toggleTheme()" style="border-radius:10px;width:38px;height:38px;">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>
    <div id="profileMenu" style="display:none;">
        <div class="dropdown">
            <button class="btn btn-ghost btn-sm dropdown-toggle d-flex align-items-center gap-2" type="button"
                id="profileDropdownBtn" data-bs-toggle="dropdown" style="border-radius:999px;padding:4px 12px 4px 4px;">
                <!-- ‚òÖ Avatar container ‚Äî ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á -->
                <div id="profileAvatar" class="rounded-circle d-flex align-items-center justify-content-center overflow-hidden"
                    style="width:32px;height:32px;background:var(--gold);flex-shrink:0;">
                    <i class="fas fa-user" style="font-size:12px;color:#1a0a00;"></i>
                </div>
                <span id="profileName" class="d-none d-sm-inline" style="font-size:0.85rem;font-weight:600;"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow-lg" style="min-width:200px;">
                <li><button class="dropdown-item" type="button" onclick="openProfileModal()"><i class="fas fa-user-edit me-2 text-muted"></i>‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button></li>
                <li id="adminMenuEntry" style="display:none;"><button class="dropdown-item" type="button" onclick="openAdminPanel()" style="color:#c9973a;font-weight:700;"><i class="fas fa-crown me-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏® (Admin)</button></li>
                <li><hr class="dropdown-divider"></li>
                <li><button class="dropdown-item text-danger" type="button" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button></li>
            </ul>
        </div>
    </div>
</div>

<!-- =============================== SCREENS =============================== -->
<div class="container-fluid d-flex align-items-center justify-content-center min-vh-100 py-5">

    <!-- ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ -->
    <div class="screen active" id="screen-auth" style="width:100%;max-width:440px;">
        <!-- ‚òÖ Logo ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô -->
        <div class="logo-container mb-3">
            <div class="logo-hero">
                <img src="/logo.png" alt="Exploding Kittens">
            </div>
            <p class="logo-subtitle">Multiplayer Online</p>
        </div>
        <div class="auth-card" style="margin-top:16px;">
            <div style="padding:28px 28px 24px;">
                <div class="auth-pills nav nav-pills nav-fill mb-4">
                    <div class="nav-item"><button class="nav-link pill-tab active" id="authTabLogin" type="button" onclick="setAuthMode('login')"><i class="fas fa-user me-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button></div>
                    <div class="nav-item"><button class="nav-link pill-tab" id="authTabSignup" type="button" onclick="setAuthMode('signup')"><i class="fas fa-user-plus me-2"></i>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button></div>
                </div>
                <form id="authForm" data-mode="login" onsubmit="submitAuth(event)">
                    <div class="mb-3">
                        <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-envelope" style="font-size:0.82rem;"></i></span>
                            <input type="email" class="form-control" id="authEmail" placeholder="name@email.com" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-lock" style="font-size:0.82rem;"></i></span>
                            <input type="password" class="form-control" id="authPassword" placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£" required minlength="4">
                        </div>
                    </div>
                    <div class="mb-3" id="authDisplayNameGroup" style="display:none;">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÄ‡∏Å‡∏°</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-id-badge" style="font-size:0.82rem;"></i></span>
                            <input type="text" class="form-control" id="authDisplayName" maxlength="20" placeholder="‡πÄ‡∏ä‡πà‡∏ô NINJA, JUN...">
                        </div>
                    </div>
                    <div id="authAvatarGroup" style="display:none;">
                        <label class="form-label">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                        <div class="d-flex gap-2 flex-wrap">
                            <span style="font-size:1.5rem;cursor:pointer;" onclick="authAvatarState={type:'emoji',value:'üê±'};showToast('‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å üê±')">üê±</span>
                            <span style="font-size:1.5rem;cursor:pointer;" onclick="authAvatarState={type:'emoji',value:'üê∂'};showToast('‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å üê∂')">üê∂</span>
                            <span style="font-size:1.5rem;cursor:pointer;" onclick="authAvatarState={type:'emoji',value:'ü¶ä'};showToast('‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ü¶ä')">ü¶ä</span>
                            <span style="font-size:1.5rem;cursor:pointer;" onclick="authAvatarState={type:'emoji',value:'üêº'};showToast('‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å üêº')">üêº</span>
                            <span style="font-size:1.5rem;cursor:pointer;" onclick="authAvatarState={type:'emoji',value:'üí•'};showToast('‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å üí•')">üí•</span>
                        </div>
                    </div>
                    <button class="btn btn-orange w-100 py-3 fw-bold mt-3" id="authSubmitBtn" type="submit" style="font-size:0.95rem;border-radius:12px;">
                        <i class="fas fa-sign-in-alt me-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </form>
                <p class="mt-3 text-center" style="color:var(--text-3);font-size:0.76rem;">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ HOME SCREEN ‚îÄ‚îÄ -->
    <div class="screen" id="screen-home" style="width:100%;max-width:440px;">
        <div class="logo-container mb-3">
            <div class="logo-hero">
                <img src="/logo.png" alt="Exploding Kittens">
            </div>
            <p class="logo-subtitle">‡πÄ‡∏Å‡∏°‡πÑ‡∏û‡πà‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î Multiplayer ‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
        </div>
        <div class="card" style="margin-top:16px;">
            <div class="card-body p-4" style="display:flex;flex-direction:column;gap:12px;">
                <button class="btn btn-orange w-100 py-3 fw-bold" onclick="requireLoginOr(goToCreateRoom)">
                    <i class="fas fa-plus-circle me-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                </button>
                <button class="btn btn-ghost w-100 py-3 fw-bold" onclick="requireLoginOr(goToJoinRoom)">
                    <i class="fas fa-sign-in-alt me-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á
                </button>
                <hr style="border-color:var(--border);">
                <button class="btn btn-ghost w-100 py-3" onclick="openProfileModal()">
                    <i class="fas fa-user me-2"></i>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </button>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ CREATE ROOM ‚îÄ‚îÄ -->
    <div class="screen" id="screen-create" style="width:100%;max-width:440px;">
        <div class="logo-container mb-3">
            <div class="logo-hero logo-lobby">
                <img src="/logo.png" alt="Exploding Kittens">
            </div>
        </div>
        <div class="card" style="margin-top:12px;">
            <div class="card-body p-4">
                <h2 class="card-title mb-4" style="font-family:'Cinzel',serif;font-size:1.3rem;"><i class="fas fa-plus-circle me-2" style="color:var(--gold);"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h2>
                <div style="display:flex;flex-direction:column;gap:12px;">
                    <button class="btn btn-ghost w-100 py-2" style="border:1px dashed var(--border);" onclick="openCardSelectionModal()">
                        <i class="fas fa-layer-group me-2" style="color:var(--gold);"></i>üÉè ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ
                    </button>
                    <button class="btn btn-orange w-100 py-2 fw-bold" onclick="requireLoginOr(createRoom)">
                        <i class="fas fa-check me-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á
                    </button>
                    <button class="btn btn-ghost w-100 py-2" onclick="goToHome()">
                        <i class="fas fa-arrow-left me-2"></i>‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ JOIN ROOM ‚îÄ‚îÄ -->
    <div class="screen" id="screen-join" style="width:100%;max-width:440px;">
        <div class="logo-container mb-3">
            <div class="logo-hero logo-lobby">
                <img src="/logo.png" alt="Exploding Kittens">
            </div>
        </div>
        <div class="card" style="margin-top:12px;">
            <div class="card-body p-4">
                <h2 class="card-title mb-4" style="font-family:'Cinzel',serif;font-size:1.3rem;"><i class="fas fa-sign-in-alt me-2" style="color:var(--gold);"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</h2>
                <div class="mb-4">
                    <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á</label>
                    <input type="text" class="form-control text-center" id="roomCode" placeholder="XXXX" maxlength="4"
                        style="text-transform:uppercase;font-size:28px;letter-spacing:12px;font-weight:900;border-radius:12px;padding:16px;font-family:'Cinzel',serif;">
                </div>
                <div style="display:flex;flex-direction:column;gap:12px;">
                    <button class="btn btn-orange w-100 py-2 fw-bold" onclick="requireLoginOr(joinRoom)">
                        <i class="fas fa-check me-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
                    </button>
                    <button class="btn btn-ghost w-100 py-2" onclick="goToHome()">
                        <i class="fas fa-arrow-left me-2"></i>‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ LOBBY HOST ‚îÄ‚îÄ -->
    <div class="screen" id="screen-lobby" style="width:100%;max-width:700px;">
        <div class="card mb-4 border-0 overflow-hidden">
            <div class="card-body p-4 gradient-box gradient-box-orange">
                <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
                    <div>
                        <p class="mb-2 fw-bold" style="color:rgba(255,255,255,0.55);font-size:0.78rem;letter-spacing:0.12em;text-transform:uppercase;">‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á</p>
                        <p class="mb-2 fw-bold text-white" id="displayRoomCode" style="font-size:3rem;letter-spacing:6px;line-height:1;font-family:'Cinzel',serif;">----</p>
                        <button class="btn btn-sm" onclick="copyRoomCode()" style="background:rgba(255,255,255,0.18);color:#fff;border:1px solid rgba(255,255,255,0.3);border-radius:8px;font-weight:600;font-size:0.78rem;">
                            <i class="fas fa-copy me-2"></i>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                        </button>
                    </div>
                    <div class="qr-box-outer">
                        <p class="mb-2 fw-bold text-dark" style="font-size:0.72rem;">QR ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</p>
                        <div class="qr-box" id="qrContainer"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-4">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <!-- ‚òÖ Logo ‡πÉ‡∏ô lobby ‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏≠‡∏î‡∏µ -->
                    <div class="d-flex align-items-center gap-3">
                        <img src="/logo.png" alt="Exploding Kittens" style="height:52px;object-fit:contain;">
                        <span style="font-family:'Cinzel',serif;font-size:1.1rem;font-weight:700;color:var(--text-1);">‡πÄ‡πÄ‡∏°‡∏ß‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î</span>
                    </div>
                    <span class="badge p-2" style="font-size:0.78rem;background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.35);"><i class="fas fa-circle me-2" style="font-size:0.5rem;"></i>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà</span>
                </div>
                <div class="alert mb-4" style="background:rgba(192,57,43,0.08);border:1px solid rgba(192,57,43,0.25);border-radius:var(--radius-sm);font-size:0.83rem;color:var(--text-2);">
                    <i class="fas fa-exclamation-triangle me-2" style="color:var(--red);"></i>‡∏≠‡∏¢‡πà‡∏≤‡πÅ‡∏ä‡∏£‡πå‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å!
                    <br>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö <strong>2‚Äì5 ‡∏Ñ‡∏ô</strong>
                </div>
                <h5 class="mb-3" style="font-size:0.82rem;color:var(--text-2);text-transform:uppercase;letter-spacing:0.08em;">
                    <i class="fas fa-users me-2"></i>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (<span id="playerCount">1</span>/5)
                </h5>
                <div id="playersList" class="mb-4" style="max-height:280px;overflow-y:auto;"></div>
                <div style="display:flex;flex-direction:column;gap:12px;">
                    <button class="btn btn-ghost w-100 py-2" style="border:1px dashed var(--border);" onclick="openCardSelectionModal()">
                        <i class="fas fa-layer-group me-2" style="color:var(--gold);"></i>üÉè ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ
                    </button>
                    <button class="btn btn-success w-100 py-2 fw-bold" onclick="startGame()" style="border-radius:var(--radius-sm);font-family:'Cinzel',serif;">
                        <i class="fas fa-play me-2"></i>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!
                    </button>
                    <button class="btn btn-ghost w-100 py-2" onclick="leaveLobby()">
                        <i class="fas fa-sign-out-alt me-2"></i>‡∏≠‡∏≠‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ LOBBY GUEST ‚îÄ‚îÄ -->
    <div class="screen" id="screen-guest-lobby" style="width:100%;max-width:500px;">
        <div class="logo-container mb-3">
            <div class="logo-hero logo-lobby">
                <img src="/logo.png" alt="Exploding Kittens">
            </div>
        </div>
        <div class="card" style="margin-top:12px;">
            <div class="card-body p-4">
                <h2 class="card-title mb-4" style="font-family:'Cinzel',serif;font-size:1.2rem;"><i class="fas fa-hourglass-start me-2" style="color:var(--gold);"></i>‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...</h2>
                <div class="gradient-box mb-4">
                    <p class="mb-1 fw-bold" style="color:rgba(255,255,255,0.55);font-size:0.78rem;letter-spacing:0.1em;text-transform:uppercase;">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>
                    <p style="font-size:2.8rem;font-weight:900;letter-spacing:6px;font-family:'Cinzel',serif;margin:0;" id="guestRoomCode">----</p>
                </div>
                <h5 class="mb-3" style="font-size:0.82rem;color:var(--text-2);text-transform:uppercase;letter-spacing:0.08em;">
                    <i class="fas fa-users me-2"></i>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (<span id="guestPlayerCount">1</span>)
                </h5>
                <div id="guestPlayersList" class="mb-4" style="max-height:280px;overflow-y:auto;"></div>
                <div class="alert mb-3" style="background:rgba(201,151,58,0.06);border:1px solid rgba(201,151,58,0.2);border-radius:var(--radius-sm);font-size:0.88rem;color:var(--text-2);">
                    <i class="fas fa-info-circle me-2" style="color:var(--gold);"></i>‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏Å‡∏î "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°"
                </div>
                <button class="btn btn-ghost w-100 py-2" onclick="leaveLobby()">
                    <i class="fas fa-sign-out-alt me-2"></i>‡∏≠‡∏≠‡∏Å
                </button>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ GAME SCREEN ‚îÄ‚îÄ -->
    <div class="screen" id="screen-game" style="width:100%;max-width:1100px;">
        <div class="mobile-game-root">

            <!-- ‚ë† TOP BAR -->
            <div class="mgr-topbar">
                <div id="currentPlayerBanner" class="current-player-banner">üé≤ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                <div class="mgr-topbar-right">
                    <div id="attackTurnsInfo" style="display:none;" class="attack-info"></div>
                    <div style="font-size:0.72rem;color:var(--text-3);" id="roundNumText">‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 1</div>
                    <button class="btn btn-ghost btn-sm mgr-leave-btn" onclick="leaveGame()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- ‚ë° SPECTATOR -->
            <div id="spectatorBanner" class="spectator-banner" style="display:none;">
                üíÄ ‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡πÅ‡∏ö‡∏ö Spectator
            </div>

            <!-- ‚ë¢ MIDDLE AREA -->
            <div class="mgr-middle">
                <div class="mgr-players-wrap">
                    <div id="playersArea" class="players-area"></div>
                </div>

                <!-- TABLE: draw / risk / discard -->
                <div class="mgr-table">

                    <!-- Left: Draw pile -->
                    <div class="pile-area mgr-draw" id="drawPileArea" onclick="drawCard()">
                        <div class="pile-count-badge" id="deckCountBadge">?</div>
                        <div class="card-back-visual" id="drawPileVisual">
                            <img src="/cards/back.jpg" alt="Card Back"
                                 style="width:100%;height:100%;object-fit:cover;border-radius:10px;display:block;"
                                 onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
                            <div class="card-back-inner" style="display:none;">
                                <div class="card-back-logo">üí•</div>
                                <div class="card-back-text">KITTENS</div>
                            </div>
                            <div class="card-stack-layer" style="bottom:-3px;right:-3px;"></div>
                            <div class="card-stack-layer" style="bottom:-6px;right:-6px;"></div>
                        </div>
                        <div class="pile-label">‡∏à‡∏±‡πà‡∏ß</div>
                    </div>

                    <!-- Center: Risk gauge -->
                    <div class="mgr-center-col">
                        <div class="risk-gauge-area">
                            <svg class="risk-gauge-svg" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="rgba(255,255,255,0.07)" stroke-width="14" stroke-linecap="round"/>
                                <path id="gaugeGreen"  d="M 20 100 A 80 80 0 0 1 67 32"  fill="none" stroke="#22c55e" stroke-width="14" stroke-linecap="round" opacity="0.35"/>
                                <path id="gaugeYellow" d="M 67 32  A 80 80 0 0 1 133 32" fill="none" stroke="#eab308" stroke-width="14" stroke-linecap="round" opacity="0.35"/>
                                <path id="gaugeRed"    d="M 133 32 A 80 80 0 0 1 180 100" fill="none" stroke="#ef4444" stroke-width="14" stroke-linecap="round" opacity="0.35"/>
                                <path id="gaugeFill" d="M 20 100 A 80 80 0 0 1 20 100" fill="none" stroke="#22c55e" stroke-width="14" stroke-linecap="round" stroke-dasharray="0 251"/>
                                <line id="gaugeNeedle" x1="100" y1="100" x2="20" y2="100" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                                <circle cx="100" cy="100" r="5" fill="white"/>
                                <text x="14" y="116" fill="rgba(255,255,255,0.4)" font-size="9" text-anchor="middle">0%</text>
                                <text x="186" y="116" fill="rgba(255,255,255,0.4)" font-size="9" text-anchor="middle">100%</text>
                            </svg>
                            <div class="risk-label-area">
                                <div class="risk-label-text">RISK</div>
                                <div class="risk-pct" id="riskPercent">0%</div>
                            </div>
                        </div>
                        <div class="mgr-minilog" style="display:none;">
                            <div id="actionLog" class="mgr-log-inner"></div>
                        </div>
                    </div>

                    <!-- Right: Discard pile -->
                    <div class="pile-area mgr-discard">
                        <div class="pile-count-badge pile-count-discard" id="discardCountBadge">0</div>
                        <div class="discard-pile-visual" id="discardPileVisual">
                            <div class="discard-empty-state" id="discardEmptyState">‡∏Å‡∏≠‡∏á‡∏ó‡∏¥‡πâ‡∏á</div>
                        </div>
                        <div class="pile-label">‡∏ó‡∏¥‡πâ‡∏á</div>
                    </div>

                </div><!-- /mgr-table -->
            </div><!-- /mgr-middle -->

            <!-- ‚ë£ HAND SECTION -->
            <div class="mgr-hand-section">
                <div class="mgr-action-bar">
                    <button id="playCardBtn" class="btn btn-orange mgr-btn-play fw-bold" onclick="playSelectedCards()" disabled>
                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏û‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô
                    </button>
                    <button id="drawCardBtn" class="btn draw-btn btn-draw-disabled mgr-btn-draw" onclick="drawCard()">
                        üé¥ ‡∏à‡∏±‡πà‡∏ß
                    </button>
                </div>
                <div class="hand-area-wrapper">
                    <div id="myHand" class="hand-area"></div>
                </div>
                <p class="mgr-hint">üí° ‡πÅ‡∏ï‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ¬∑ Nope ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠</p>
            </div>

        </div><!-- /mobile-game-root -->
    </div>

</div>

<!-- ======================== MODALS ======================== -->

<!-- Modal: Card Selection -->
<div class="modal fade" id="cardSelectionModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" style="max-width:480px;">
        <div class="modal-content" style="border-top:2px solid var(--gold);">
            <div class="modal-header" style="background:rgba(201,151,58,0.05);">
                <h5 class="modal-title" style="color:var(--gold);font-family:'Cinzel',serif;"><i class="fas fa-layer-group me-2"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding:16px 20px;max-height:65vh;overflow-y:auto;">
                <div id="cardSelectionList"></div>
            </div>
            <div class="modal-footer" style="gap:8px;">
                <button class="btn btn-ghost" onclick="resetCardSelection()"><i class="fas fa-undo me-1"></i>‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                <button class="btn btn-orange fw-bold" onclick="saveCardSelection()"><i class="fas fa-save me-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Target Picker -->
<div class="modal fade" id="targetPickerModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-top:2px solid var(--gold);">
            <div class="modal-header" style="background:rgba(201,151,58,0.06);">
                <h5 class="modal-title" style="color:var(--gold);font-family:'Cinzel',serif;" id="targetPickerTitle">üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="cancelTargetPick()"></button>
            </div>
            <div class="modal-body" style="padding:16px;">
                <p id="targetPickerDesc" style="color:var(--text-2);font-size:0.85rem;margin-bottom:14px;"></p>
                <div id="targetPickerList" class="d-flex flex-column gap-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Card Picker -->
<div class="modal fade" id="cardPickerModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-top:2px solid var(--gold);">
            <div class="modal-header" style="background:rgba(201,151,58,0.06);">
                <h5 class="modal-title" style="color:var(--gold);font-family:'Cinzel',serif;" id="cardPickerTitle">üÉè ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏û‡πà</h5>
            </div>
            <div class="modal-body" style="padding:14px 12px;">
                <p id="cardPickerDesc" style="color:var(--text-2);font-size:0.82rem;margin-bottom:12px;"></p>
                <div id="cardPickerList" class="card-picker-grid"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: See the Future -->
<div class="modal fade" id="seeFutureModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">üîÆ See the Future</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="seeFutureContent"></div>
            <div class="modal-footer">
                <button class="btn btn-ghost" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Insert Exploding Kitten -->
<div class="modal fade" id="insertModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-top:2px solid #22c55e;">
            <div class="modal-header" style="background:rgba(34,197,94,0.06);">
                <h5 class="modal-title" style="color:#22c55e;font-family:'Cinzel',serif;">üõ°Ô∏è Defuse ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h5>
            </div>
            <div class="modal-body">
                <p style="color:var(--text-2);">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏™‡πà <strong>üí• ‡πÄ‡πÄ‡∏°‡∏ß‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î</strong> ‡∏Ñ‡∏∑‡∏ô‡πÉ‡∏ô‡∏Å‡∏≠‡∏á‡πÑ‡∏û‡πà</p>
                <div class="my-3">
                    <input type="range" class="form-range" id="insertSlider" min="0" max="20" value="10" oninput="updateInsertLabel()">
                </div>
                <div class="insert-position-label" id="insertPositionLabel">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏≠‡∏á</div>
                <p class="text-muted small mt-2">0 = ‡∏ö‡∏ô‡∏™‡∏∏‡∏î (‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢) | ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î = ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success fw-bold w-100" onclick="confirmInsert()">
                    <i class="fas fa-check me-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Favor -->
<div class="modal fade" id="favorModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-top:2px solid #eab308;">
            <div class="modal-header" style="background:rgba(234,179,8,0.06);">
                <h5 class="modal-title" style="color:#eab308;font-family:'Cinzel',serif;">üôÄ Favor!</h5>
            </div>
            <div class="modal-body">
                <p id="favorMessage" style="color:var(--text-2);font-weight:600;margin-bottom:16px;"></p>
                <div id="favorCardList" class="d-flex flex-wrap gap-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Steal 3 -->
<div class="modal fade" id="steal3Modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">üê± ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡πÇ‡∏°‡∏¢</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p style="color:var(--text-2);">‡∏Ç‡πÇ‡∏°‡∏¢‡∏à‡∏≤‡∏Å: <strong id="steal3TargetName"></strong></p>
                <div id="steal3CardList" class="d-flex flex-wrap gap-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Discard 5 -->
<div class="modal fade" id="discard5Modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">üê± ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏û‡πà‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏¥‡πâ‡∏á</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p style="color:var(--text-2);">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏¥‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏¥‡πâ‡∏á</p>
                <div id="discard5CardList" class="d-flex flex-wrap gap-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Alter the Future -->
<div class="modal fade" id="alterFutureModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">üëÅÔ∏è ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÑ‡∏û‡πà</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p style="color:var(--text-2);">‡∏î‡∏π‡πÑ‡∏û‡πà 3 ‡πÉ‡∏ö‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∑‡πà‡∏ô)</p>
                <div id="alterFutureCardsList" class="d-flex flex-column gap-2"></div>
                <input type="hidden" id="alterFutureCardData">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button type="button" class="btn btn-primary" onclick="confirmAlterFuture()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Clairvoyance -->
<div class="modal fade" id="clairvoyanceModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">üîÆ Clairvoyance</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="clairvoyanceContent">
                <p style="color:var(--text-2);text-align:center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Clone -->
<div class="modal fade" id="cloneModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">üìã Clone</h5>
            </div>
            <div class="modal-body" id="cloneContent">
                <p style="color:var(--text-2);text-align:center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Dig Deeper -->
<div class="modal fade" id="digDeeperModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">üîç Dig Deeper</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p style="color:var(--text-2);">‡∏à‡∏±‡πà‡∏ß 2 ‡πÑ‡∏û‡πà ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏µ‡∏Å‡πÉ‡∏ö</p>
                <div id="digDeeperCardsList" class="d-flex flex-column gap-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Draw from the Bottom -->
<div class="modal fade" id="drawFromBottomModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">‚¨áÔ∏è Draw from the Bottom</h5>
            </div>
            <div class="modal-body" id="drawFromBottomContent">
                <p style="color:var(--text-2);text-align:center;">‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Attack...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Reverse -->
<div class="modal fade" id="reverseModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;">üîÑ Reverse</h5>
            </div>
            <div class="modal-body" id="reverseContent">
                <p style="color:var(--text-2);text-align:center;">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ñ‡∏π‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Profile -->
<div class="modal fade" id="profileModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" style="max-width:420px;">
        <div class="modal-content">
            <div class="modal-header" style="background:rgba(249,174,66,0.05);border-bottom:2px solid var(--gold);">
                <h5 class="modal-title" style="font-family:'Cinzel',serif;font-weight:900;color:var(--gold);"><i class="fas fa-user-circle me-2"></i>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding:28px;">
                <form id="profileForm" onsubmit="submitProfile(event)">
                    <!-- Profile Picture -->
                    <div class="mb-4" style="text-align:center;">
                        <div class="profile-pic-container" style="position:relative;display:inline-block;width:140px;height:140px;margin:0 auto;margin-bottom:16px;">
                            <div id="profilePictureDisplay" class="rounded-circle" style="width:140px;height:140px;background:linear-gradient(135deg,#1F6C36,#2D8C4D);display:flex;align-items:center;justify-content:center;font-size:3.5rem;border:4px solid var(--gold);box-shadow:0 8px 24px rgba(0,0,0,0.4);overflow:hidden;">
                                <i class="fas fa-user" style="color:rgba(255,255,255,0.5);"></i>
                            </div>
                            <label class="profile-pic-upload-overlay" style="position:absolute;inset:0;cursor:pointer;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);border-radius:50%;opacity:0;transition:opacity 0.2s;font-size:1.5rem;color:#fff;border:3px dashed var(--gold);">
                                <i class="fas fa-camera"></i>
                                <input type="file" id="profilePictureInput" accept="image/*" style="display:none;" onchange="handleProfilePictureChange(event)">
                            </label>
                        </div>
                        <style>
                            .profile-pic-container:hover .profile-pic-upload-overlay { opacity: 1; }
                        </style>
                        <div style="font-size:0.75rem;color:rgba(245,230,200,0.5);font-style:italic;">
                            üëÜ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ JPG/PNG (‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5MB)
                        </div>
                    </div>
                    <hr style="border-color:var(--border);margin:24px 0;">
                    <div class="mb-3">
                        <label class="form-label" style="font-size:0.85rem;color:rgba(245,230,200,0.7);text-transform:uppercase;letter-spacing:0.05em;font-weight:700;">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <div id="profileEmail" style="padding:10px 14px;background:rgba(249,174,66,0.05);border:1px solid rgba(249,174,66,0.2);border-radius:8px;font-size:0.95rem;font-family:monospace;">-</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" style="font-size:0.85rem;color:rgba(245,230,200,0.7);text-transform:uppercase;letter-spacing:0.05em;font-weight:700;">‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÄ‡∏Å‡∏°</label>
                        <div id="profileDisplayName" style="padding:10px 14px;background:rgba(249,174,66,0.05);border:1px solid rgba(249,174,66,0.2);border-radius:8px;font-size:0.95rem;font-weight:600;color:var(--gold);">-</div>
                        <small style="color:rgba(245,230,200,0.5);display:block;margin-top:6px;">üí° ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ã‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</small>
                    </div>
                    <div class="mb-4">
                        <label class="form-label" style="font-size:0.85rem;color:rgba(245,230,200,0.7);text-transform:uppercase;letter-spacing:0.05em;font-weight:700;">‡∏¢‡∏®</label>
                        <div id="profileRank" style="padding:10px 14px;background:rgba(249,174,66,0.05);border:1px solid rgba(249,174,66,0.2);border-radius:8px;font-size:0.95rem;color:var(--text-2);">‡πÑ‡∏°‡πà‡∏°‡∏µ</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="border-top:1px solid var(--border);padding:16px 24px;">
                <button type="button" class="btn btn-ghost" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                <button type="button" class="btn fw-bold" style="background:var(--gold);color:#1a0a00;" onclick="submitProfile(event)"><i class="fas fa-save me-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Admin Panel -->
<div class="modal fade" id="adminPanelModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" style="max-width:480px;">
        <div class="modal-content" style="border-top:2px solid var(--gold);">
            <div class="modal-header" style="background:rgba(201,151,58,0.05);">
                <h5 class="modal-title" style="color:var(--gold);font-weight:800;font-family:'Cinzel',serif;"><i class="fas fa-crown me-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏®</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding:20px 24px;">
                <div class="mb-4">
                    <label class="form-label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <div class="d-flex gap-2">
                        <input type="email" class="form-control" id="adminSearchEmail" placeholder="email@example.com">
                        <button class="btn btn-ghost flex-shrink-0 fw-bold" onclick="adminSearchUser()"><i class="fas fa-search me-1"></i>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    </div>
                    <div id="adminSearchResult" class="mt-2" style="font-size:0.83rem;"></div>
                </div>
                <div id="adminRoomPlayers">
                    <label class="form-label">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</label>
                    <div id="adminRoomPlayersList" class="d-flex flex-column gap-2"></div>
                </div>
                <div id="adminRankEditor" style="display:none;" class="mt-3">
                    <div style="background:rgba(201,151,58,0.05);border:1px solid rgba(201,151,58,0.2);border-radius:var(--radius-md);padding:16px;">
                        <div class="fw-bold mb-3" id="adminTargetName"></div>
                        <div class="text-muted small mb-3" id="adminTargetEmail"></div>
                        <div class="mb-3">
                            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏® <span style="color:var(--text-3);font-size:0.7rem;">(‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á = ‡∏•‡∏ö‡∏¢‡∏®)</span></label>
                            <input type="text" class="form-control" id="adminRankName" maxlength="20" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≤‡∏ä‡∏≤ ¬∑ MVP">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">‡∏™‡∏µ‡∏¢‡∏®</label>
                            <input type="color" class="form-control form-control-color" id="adminRankColor" value="#c9973a">
                        </div>
                        <button class="btn btn-orange w-100 fw-bold" onclick="adminApplyRank()"><i class="fas fa-save me-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ======================== SCRIPTS ======================== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<!-- ‚òÖ Modular Scripts (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á) ‚òÖ -->
<script src="/modules/game-state.js"></script>
<script src="/modules/cards.js"></script>
<script src="/modules/audio.js"></script>
<script src="/modules/ui-common.js"></script>
<script src="/modules/room.js"></script>
<script src="/modules/animations.js"></script>
<script src="/modules/hand.js"></script>
<script src="/modules/game-rendering.js"></script>
<script src="/modules/game-actions.js"></script>
<script src="/modules/socket-handlers.js"></script>
<script src="/modules/auth.js"></script>
<script src="/modules/game.js"></script>
</body>
</html>